
<html><head><base href="https://.io/infinite-team-schedule/">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Escala de Equipes Infinita com Frases Motivacionais</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

  body {
    font-family: 'Roboto', Arial, sans-serif;
    margin: 0;
    padding: 10px;
    background-color: #f0f0f0;
    font-size: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    width: 100%;
    max-width: 1080px;
    margin: 0 auto;
  }
  body.dark-mode {
    background-color: #121212;
    color: white;
  }
  .container {
    width: 100%;
    max-width: 1080px;
    height: 1920px;
    overflow-y: auto;
    background-color: white;
    border-radius: 8px;
    padding: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    box-sizing: border-box;
  }
  h1 {
    text-align: center;
    color: #333;
    margin-bottom: 10px;
  }
  body.dark-mode h1 {
    color: white;
  }
  #credits {
    text-align: center;
    color: #333; /* Dark gray/black for light mode */
    margin-bottom: 10px;
    font-size: 0.9em;
  }
  body.dark-mode #credits {
    color: #FFD700; /* Yellow color for dark mode */
  }
  .motivational-quote {
    font-size: 0.9em;
    padding: 5px 0;
    text-align: center;
    margin-bottom: 10px;
    overflow: hidden;
    white-space: nowrap;
    box-sizing: border-box;
  }
  .motivational-quote span {
    display: inline-block;
    padding-left: 100%;
    animation: scroll-left 20s linear infinite;
  }
  @keyframes scroll-left {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
  }
  /* Update the option watermark animation */
  td .option-watermark {
    position: absolute;
    top: 50%;
    left: 0;
    transform: translateY(-50%);
    opacity: 0.3;
    white-space: nowrap;
    width: 100%;
    overflow: hidden;
    pointer-events: none; /* Prevent interference with cell clicks */
  }
  /* Ensure content stays in place */
  td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
    height: 40px; /* Set fixed height */
    position: relative;
    overflow: hidden; /* Hide overflow content */
    z-index: 1;
  }
  /* Remove the existing floatText animation since we're using scroll-left instead */
  @keyframes floatText {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-5px); }
    100% { transform: translateY(0px); }
  }
  /* Update the cell option styling */
  td .option-watermark {
    opacity: 0.3;
    animation: scroll-left 20s linear infinite;
  }
  .dark-mode-toggle {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 24px;
    padding: 5px 10px;
    margin: 0 5px;
    vertical-align: middle;
  }
  .dark-mode-toggle .sun {
    display: none;
  }
  body.dark-mode .dark-mode-toggle .sun {
    display: inline;
  }
  body.dark-mode .dark-mode-toggle .moon {
    display: none;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
  }
  th {
    background-color: #f2f2f2;
    font-weight: bold;
  }
  body.dark-mode th {
    background-color: #006400; /* Dark green */
    color: white;
  }
  .controls {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
  }
  input, select, button {
    margin: 0 5px;
    padding: 5px;
  }
  button {
    border-radius: 0 !important; /* Override any existing border-radius */
  }
  .highlight {
    background-color: #006400 !important; /* Dark green */
    color: white !important;
  }
  .weekend {
    background-color: #f0f0f0;
  }
  body.dark-mode .weekend {
    background-color: #2a2a2a;
    color: #ffeb3b; /* Yellow color for weekend text */
  }
  .current-month {
    font-weight: bold;
  }
  .current-day {
    background-color: #e6f7ff;
  }
  .month-header {
    background-color: #006400 !important; /* Dark green */
    color: white !important;
    font-size: 1.2em;
    padding: 10px;
    text-align: center;
  }
  body.dark-mode .container {
    background-color: #1e1e1e;
    color: #ffffff;
  }
  body.dark-mode th,
  body.dark-mode td {
    color: white;
  }
  body.dark-mode .current-day {
    background-color: #1a3f55;
  }
  body.dark-mode .month-header {
    background-color: #004d00 !important; /* Darker green for dark mode */
  }
  .watermark {
    position: absolute;
    right: 5px;
    bottom: 5px;
    font-size: 0.8em;
    opacity: 0.5;
  }
  .tooltip {
    visibility: hidden;
    width: 120px;
    background-color: #555;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 5px 0;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -60px;
    opacity: 0;
    transition: opacity 0.3s;
  }
  td:hover .tooltip {
    visibility: visible;
    opacity: 1;
  }
  .options-list {
    display: none;
    position: fixed; /* Change to fixed */
    background-color: #f9f9f9;
    min-width: 200px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1000; /* Increase z-index */
    border-radius: 4px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }
  .options-list button {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    width: 100%;
    text-align: left;
    border: none;
    background-color: transparent;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  .options-list button:hover {
    background-color: #f1f1f1;
  }
  body.dark-mode .options-list {
    background-color: #333;
  }
  body.dark-mode .options-list button {
    color: white;
  }
  body.dark-mode .options-list button:hover {
    background-color: #444;
  }
  #optionSelect option[value="DEJEM"] {
    background-color: red;
    color: white;
  }
  #optionSelect option[value="DELEGADA"] {
    background-color: green;
    color: white;
  }
  #optionSelect option[value="FOLGA MENSAL"] {
    background-color: blue;
    color: white;
  }
  #optionSelect option[value="TROCA DE SERVIÇO"] {
    background-color: orange;
    color: black;
  }
  #optionSelect option[value="OUTROS"] {
    background-color: purple;
    color: white;
  }
  #optionSelect option[value="CANCELAR"] {
    background-color: yellow;
    color: black;
  }
  td.option-selected {
    position: relative;
  }
  @keyframes neonPulse {
    0% { box-shadow: 0 0 5px #ff00ff, inset 0 0 5px #ff00ff; }
    50% { box-shadow: 0 0 20px #ff00ff, inset 0 0 10px #ff00ff; }
    100% { box-shadow: 0 0 5px #ff00ff, inset 0 0 5px #ff00ff; }
  }
  td.option-selected {
    border: 2px solid #ff00ff;
    animation: neonPulse 1.5s infinite;
  }
  td.option-dejem::after { border-color: red; }
  td.option-delegada::after { border-color: green; }
  td.option-folga-mensal::after { border-color: blue; }
  td.option-troca-serviço::after { border-color: orange; }
  td.option-outros::after { border-color: purple; }
  @keyframes blink {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
  }
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
  }
  .modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 90%;
    max-width: 300px;
    text-align: center;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }
  body.dark-mode .modal-content {
    background-color: #1e1e1e;
    color: white;
    border: 1px solid #444;
  }
  body.dark-mode .modal-content h3 {
    color: white;
  }
  @media screen and (max-width: 768px) {
    body {
      padding: 5px;
    }

    .controls {
      flex-direction: column;
      gap: 10px;
    }

    .controls input,
    .controls select,
    .controls button {
      width: 100%;
      margin: 5px 0;
    }

    h1 {
      font-size: 1.5em;
    }

    .month-header {
      font-size: 1em;
    }

    .options-list {
      width: 200px;
      left: 50% !important;
      transform: translateX(-50%);
    }
  }

  @media screen and (max-width: 320px) {
    table {
      font-size: 11px;
    }

    th, td {
      padding: 2px;
      font-size: 11px;
      height: 40px; /* Set fixed height */
    }

    .watermark {
      font-size: 0.7em;
    }
  }

  /* Add this to the existing CSS */
  .team-highlight {
    background-color: #ffd700 !important; /* Yellow */
  }

  body.dark-mode .team-highlight {
    background-color: #b8860b !important; /* Darker yellow for dark mode */
  }

  /* Ensure columns have reasonable widths */
  td:nth-child(1) { /* Dia */
    width: 10%;
  }
  td:nth-child(2) { /* Dia da Semana */
    width: 20%;
  }
  td:nth-child(3), /* Equipe Dia */
  td:nth-child(4) { /* Equipe Noite */
    width: 35%;
  }
  tbody tr:hover {
    background-color: #f5f5f5;
  }
  body.dark-mode tbody tr:hover {
    background-color: #2d2d2d;
  }
</style>
</head>
<body>
<div class="container">
  <h1>Escala de Equipes <span id="currentYear"></span></h1>
  <div id="credits">
    Criado por: Setor de Tecnologia COPOM.<br>
    Cap PM Alexandria, Sgt PM Ignácio, Cb PM Sales Lima, Cb PM Pivaro, Sd PM Botelho.
  </div>
  <div class="motivational-quote" id="motivationalQuote"></div>
  <div class="controls">
    <input type="number" id="yearInput" placeholder="Ano" value="2024">
    <select id="teamSelect">
      <option value="">Escolha Equipe</option>
      <option value="A">Equipe A</option>
      <option value="B">Equipe B</option>
      <option value="C">Equipe C</option>
      <option value="D">Equipe D</option>
      <option value="E">Equipe E</option>
    </select>
    <button onclick="updateSchedule()">OK</button>
    <button class="dark-mode-toggle" onclick="toggleDarkMode()">
      <span class="moon">🌙</span>
      <span class="sun">☀️</span>
    </button>
  </div>
  <div id="scheduleContainer"></div>
</div>

<div id="optionsList" class="options-list">
  <button onclick="selectOption('DELEGADA')">DELEGADA</button>
  <button onclick="selectOption('DEJEM')">DEJEM</button>
  <button onclick="selectOption('TROCA DE SERVIÇO')">TROCA SERVIÇO</button>
  <button onclick="selectOption('FOLGA MENSAL')">FOLGA MENSAL</button>
  <button onclick="selectOption('OUTROS')">OUTROS</button>
  <button onclick="selectOption('CANCELAR')">CANCELAR</button>
</div>

<div id="customTextDialog" class="modal">
  <div class="modal-content">
    <h3>Digite o texto personalizado</h3>
    <input type="text" id="customTextInput" minlength="5" maxlength="20">
    <button onclick="saveCustomText()">Salvar</button>
    <button onclick="closeCustomTextDialog()">Cancelar</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
const motivationalQuotes = [
  "A persistência é o caminho do êxito.",
    "O sucesso nasce do querer, da determinação e persistência em se chegar a um objetivo.",
    "Nada é impossível para aquele que persiste.",
    "O único lugar onde o sucesso vem antes do trabalho é no dicionário.",
    "Acredite em si próprio e chegará um dia em que os outros não terão outra escolha senão acreditar com você.",
    "O sucesso é a soma de pequenos esforços repetidos dia após dia.",
    "Toda ação humana, quer se torne positiva ou negativa, precisa depender de motivação.",
    "A verdadeira motivação vem de realização, desenvolvimento pessoal, satisfação no trabalho e reconhecimento.",
    "O insucesso é apenas uma oportunidade para recomeçar com mais inteligência.",
    "Você nunca sabe que resultados virão da sua ação. Mas se você não fizer nada, não existirão resultados.",
    "Não espere por uma crise para descobrir o que é importante em sua vida.",
    "A melhor maneira de prever o futuro é criá-lo.",
    "O pessimista vê dificuldade em cada oportunidade. O otimista vê oportunidade em cada dificuldade.",
    "Nós somos o que fazemos repetidamente. Excelência, então, não é um ato, mas um hábito.",
    "Se você não pode fazer grandes coisas, faça pequenas coisas de uma maneira grandiosa.",
    "O sucesso é a soma de pequenos esforços repetidos dia após dia.",
    "Acredite em si mesmo e todo o resto se encaixará.",
    "A jornada de mil milhas começa com um único passo.",
    "A única maneira de fazer um excelente trabalho é amar o que você faz.",
    "O fracasso é o condimento que dá sabor ao sucesso.",
    "A motivação é o que faz você começar. O hábito é o que faz você continuar.",
    "A única maneira de alcançar o impossível é acreditar que é possível.",
    "O que você consegue alcançar é limitado apenas pelo que você acredita ser possível.",
    "O sucesso é a melhor vingança para aqueles que duvidaram de você.",
    "A jornada de um milhão de milhas começa com um único passo.",
    "A persistência realiza o impossível.",
    "O sucesso não é final, o fracasso não é fatal: o que conta é a coragem de continuar.",
    "O maior perigo para a maioria de nós não está em definir metas altas e não atingi-las, mas em definir metas pequenas e atingi-las.",
    "A vida é 10% do que acontece conosco e 90% de como reagimos a isso.",
    "Acredite que você pode e você já está no meio do caminho.",
    "O sucesso não é para os preguiçosos.",
    "O otimismo é a fé em ação. Nada se pode realizar sem esperança e confiança.",
    "O verdadeiro segredo do sucesso é o entusiasmo.",
    "O sucesso não é sorte, é trabalho duro, perseverança, aprendizado, sacrifício e acima de tudo, amor pelo que você está fazendo ou aprendendo a fazer.",
    "Se você quer alcançar a excelência, pode chegar lá hoje. Conforme o grande impulsionador, o tempo é agora.",
    "A vida é curta, aproveite cada momento.",
    "Não importa o quão devagar você vá, desde que você não pare.",
    "Você é mais corajoso do que acredita, mais forte do que parece e mais inteligente do que pensa.",
    "A disciplina é a ponte entre metas e realizações.",
    "O futuro pertence àqueles que acreditam na beleza de seus sonhos.",
    "O momento em que você desiste é geralmente o momento em que o milagre está prestes a acontecer.",
    "Você é capaz de mais do que imagina.",
    "A mente é como um paraquedas, só funciona se estiver aberta.",
    "O sucesso não é o final, o fracasso não é fatal: é a coragem de continuar que conta.",
    "O que você faz hoje pode melhorar todos os amanhãs.",
    "A verdadeira motivação vem de realização, desenvolvimento pessoal, satisfação no trabalho e reconhecimento.",
    "A mente é tudo. Você se torna aquilo que você pensa.",
    "O trabalho árduo vence o talento quando o talento não trabalha duro.",
    "A melhor forma de prever o futuro é criá-lo.",
    "A excelência não é uma habilidade, é uma atitude.",
    "O sucesso é construído sobre falhas, frustrações e coragem.",
    "O entusiasmo move o mundo.",
    "Não é o que temos, mas quem somos que faz a diferença.",
    "Não espere por circunstâncias ideais, elas nunca chegarão. Comece agora.",
    "Cada dia é uma nova oportunidade para mudar sua vida.",
    "Acreditar é o primeiro passo para fazer acontecer.",
    "O sucesso é construído em pequenos passos. Cada dia é uma nova oportunidade para progredir.",
    "A melhor maneira de prever o futuro é criá-lo.",
    "A persistência realiza o impossível.",
    "A recompensa do trabalho bem-feito é a oportunidade de fazer mais.",
    "O maior prazer na vida é fazer aquilo que as pessoas dizem que você não é capaz de fazer.",
    "A chave para o sucesso é começar antes que você esteja pronto.",
    "O sucesso é a soma de pequenos esforços repetidos dia após dia.",
    "O sucesso não é garantido, mas o fracasso é certo se você não estiver tentando.",
    "A chave do sucesso é começar antes que você esteja pronto.",
    "O entusiasmo move o mundo.",
    "O futuro pertence àqueles que acreditam na beleza de seus sonhos.",
    "Não existe elevador para o sucesso, você deve subir a escada.",
    "A vida é curta, aproveite cada momento.",
    "A motivação é o que o coloca em movimento, o hábito é o que faz você continuar.",
    "A criatividade é a inteligência se divertindo.",
    "A jornada de um milhão de milhas começa com um único passo.",
    "A única maneira de fazer um excelente trabalho é amar o que você faz.",
    "A melhor maneira de prever o futuro é criá-lo.",
    "Não tenha medo de desistir do bom para perseguir o ótimo.",
    "O sucesso não é a chave para a felicidade. A felicidade é a chave para o sucesso. Se você ama o que faz, terá sucesso.",
    "O entusiasmo move o mundo.",
    "O sucesso é encontrar satisfação no próprio trabalho.",
    "A força não vem da capacidade corporal, mas da vontade da mente.",
    "O sucesso é construído sobre falhas, frustrações e coragem.",
    "Não é o que você olha que importa, é o que você vê.",
    "A persistência é o caminho do êxito.",
    "A verdadeira motivação vem de realização, desenvolvimento pessoal, satisfação no trabalho e reconhecimento."
];


let selectedCell = null;

function highlightTeam(team) {
  const cells = document.querySelectorAll('td');
  cells.forEach(cell => {
    if (!cell.classList.contains('option-selected')) {
      cell.classList.remove('team-highlight');
    }
  });

  if (!team) return;

  const dayTeamCells = document.querySelectorAll('td:nth-child(3)'); // Day team column
  const nightTeamCells = document.querySelectorAll('td:nth-child(4)'); // Night team column

  dayTeamCells.forEach(cell => {
    if (cell.textContent.trim() === team && !cell.classList.contains('option-selected')) {
      cell.classList.add('team-highlight');
    }
  });

  nightTeamCells.forEach(cell => {
    if (cell.textContent.trim() === team && !cell.classList.contains('option-selected')) {
      cell.classList.add('team-highlight');
    }
  });
  
  saveState(); // Save state after highlighting
}

function calculateStartingCounters(year) {
  const baseYear = 2024;
  const yearDiff = year - baseYear;
  
  // Calculate total days from base year to start of target year
  let totalDays = 0;
  for (let y = baseYear; y < year; y++) {
    totalDays += (new Date(y, 11, 31)).getDate(); // Get days in the year
  }
  
  // The sequence repeats every 5 positions
  const startPosition = totalDays % 5;
  
  return {
    dayTeamStart: startPosition,
    nightTeamStart: startPosition
  };
}

function showOptionsModal(event) {
  const cell = event.target.closest('td'); // Get the clicked cell
  window.currentSelectedCell = cell; // Store reference to clicked cell globally
  const optionsList = document.getElementById('optionsList');
  
  // Simply show the options list - it will be centered due to CSS
  optionsList.style.display = 'block';
}

function updateMotivationalQuote() {
  const quoteElement = document.getElementById('motivationalQuote');
  const randomQuote = motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
  quoteElement.innerHTML = `<span>${randomQuote}</span>`;
}

function saveState() {
  const year = document.getElementById('yearInput').value;
  const state = {
    year: year,
    team: document.getElementById('teamSelect').value,
    darkMode: document.body.classList.contains('dark-mode'),
    cellOptions: []
  };

  // Save cells with options for this specific year
  document.querySelectorAll('table').forEach((table, monthIndex) => {
    table.querySelectorAll('tr').forEach((row, rowIndex) => {
      if (rowIndex > 1) {
        const cells = row.querySelectorAll('td');
        const day = cells[0].textContent;
        cells.forEach((cell, cellIndex) => {
          const watermark = cell.querySelector('.option-watermark');
          if (watermark) {
            state.cellOptions.push({
              year: parseInt(year),  // Add year to identify unique cells
              month: monthIndex,
              day: parseInt(day),
              cellIndex: cellIndex,
              option: watermark.textContent,
              isHighlighted: cell.classList.contains('option-selected')
            });
          }
        });
      }
    });
  });

  localStorage.setItem(`scheduleState_${year}`, JSON.stringify(state));
  
  // Store current year and dark mode separately
  localStorage.setItem('scheduleGlobalSettings', JSON.stringify({
    darkMode: state.darkMode,
    lastYear: year
  }));
}

function loadSavedState() {
  const year = parseInt(document.getElementById('yearInput').value);
  const savedState = localStorage.getItem(`scheduleState_${year}`);
  const globalSettings = JSON.parse(localStorage.getItem('scheduleGlobalSettings') || '{}');
  
  if (globalSettings.darkMode) {
    document.body.classList.add('dark-mode');
  }

  if (savedState) {
    const state = JSON.parse(savedState);

    // Only restore options that match the current year exactly
    if (state.cellOptions) {
      setTimeout(() => {
        state.cellOptions.forEach(option => {
          if (option.year === year) { // Strict year comparison
            const tables = document.querySelectorAll('table');
            if (tables[option.month]) {
              const rows = tables[option.month].querySelectorAll('tr');
              rows.forEach(row => {
                const firstCell = row.querySelector('td');
                if (firstCell && parseInt(firstCell.textContent) === option.day) {
                  const targetCell = row.querySelectorAll('td')[option.cellIndex];
                  if (targetCell) {
                    selectOption(option.option, targetCell);
                    if (option.isHighlighted) {
                      targetCell.classList.add('option-selected');
                    }
                  }
                }
              });
            }
          }
        });
        // Apply team highlighting after options are restored
        const selectedTeam = document.getElementById('teamSelect').value;
        if (selectedTeam) {
          highlightTeam(selectedTeam);
        }
      }, 100);
    }
  }
}

function updateSchedule() {
  const yearInput = document.getElementById('yearInput');
  const year = parseInt(yearInput.value);
  
  if (year < 2024) {
    alert('Por favor, insira um ano igual ou posterior a 2024');
    yearInput.value = 2024;
    return;
  }

  // Store current selected team
  const selectedTeam = document.getElementById('teamSelect').value;

  // Generate new schedule
  generateSchedule(year);

  // Load saved options for this specific year
  loadSavedState();

  // Apply team highlighting after schedule is regenerated
  highlightTeam(selectedTeam);
}

function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
  saveState();
  generateSchedule(document.getElementById('yearInput').value || new Date().getFullYear());
  // Restore state after regenerating schedule
  loadSavedState();
}

function generateSchedule(year) {
  const scheduleContainer = document.getElementById('scheduleContainer');
  scheduleContainer.innerHTML = '';
  const currentDate = new Date();
  const currentYear = currentDate.getFullYear();
  const currentMonth = currentDate.getMonth();
  const currentDay = currentDate.getDate();
  
  const months = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                  'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
  const daysOfWeek = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];

  // Get starting positions based on year difference from 2024
  const { dayTeamStart, nightTeamStart } = calculateStartingCounters(parseInt(year));
  
  let dayTeamCounter = dayTeamStart;
  let nightTeamCounter = nightTeamStart;
  const dayTeamSequence = ['B', 'A', 'B', 'A', 'E'];  // BABAE sequence
  const nightTeamSequence = ['D', 'E', 'C', 'D', 'C']; // DECDC sequence
  
  for (let month = 0; month < 12; month++) {
    const table = document.createElement('table');
    const monthHeader = document.createElement('tr');
    const monthCell = document.createElement('th');
    monthCell.colSpan = 4;
    monthCell.textContent = `${months[month]} ${year}`;
    monthCell.className = 'month-header';
    monthHeader.appendChild(monthCell);
    table.appendChild(monthHeader);

    const headerRow = document.createElement('tr');
    ['Dia', 'Dia Semana', 'Equipe Dia', 'Equipe Noite'].forEach(header => {
      const th = document.createElement('th');
      th.textContent = header;
      headerRow.appendChild(th);
    });
    table.appendChild(headerRow);

    const daysInMonth = new Date(year, month + 1, 0).getDate();

    for (let day = 1; day <= daysInMonth; day++) {
      const date = new Date(year, month, day);
      const row = document.createElement('tr');
      
      // Day number cell
      const dayCell = document.createElement('td');
      dayCell.textContent = day;
      
      // Day of week cell
      const dayOfWeekCell = document.createElement('td');
      dayOfWeekCell.textContent = daysOfWeek[date.getDay()];
      
      // Day team cell
      const dayTeamCell = document.createElement('td');
      dayTeamCell.textContent = dayTeamSequence[dayTeamCounter % 5];
      dayTeamCell.onclick = showOptionsModal;
      
      // Night team cell
      const nightTeamCell = document.createElement('td');
      nightTeamCell.textContent = nightTeamSequence[nightTeamCounter % 5];
      nightTeamCell.onclick = showOptionsModal;

      // Add weekend class if needed
      if (date.getDay() === 0 || date.getDay() === 6) {
        dayCell.classList.add('weekend');
        dayOfWeekCell.classList.add('weekend');
        dayTeamCell.classList.add('weekend');
        nightTeamCell.classList.add('weekend');
      }

      // Highlight current day
      if (year == currentYear && month == currentMonth && day == currentDay) {
        dayCell.classList.add('current-day');
        dayOfWeekCell.classList.add('current-day');
        dayTeamCell.classList.add('current-day');
        nightTeamCell.classList.add('current-day');
      }

      row.appendChild(dayCell);
      row.appendChild(dayOfWeekCell);
      row.appendChild(dayTeamCell);
      row.appendChild(nightTeamCell);
      table.appendChild(row);

      dayTeamCounter++;
      nightTeamCounter++;
    }
    
    scheduleContainer.appendChild(table);
  }
}

function selectOption(option, targetCell = null) {
  const cell = targetCell || window.currentSelectedCell;
  if (!cell) return;
  
  if (option === 'OUTROS') {
    // Store reference to current cell and show dialog
    window.currentCustomCell = cell;
    document.getElementById('customTextDialog').style.display = 'block';
    document.getElementById('customTextInput').value = '';
    return;
  }
  
  if (option === 'CANCELAR') {
    const watermark = cell.querySelector('.option-watermark');
    if (watermark) {
      watermark.remove();
    }
    cell.classList.remove('option-selected');
    
    const team = document.getElementById('teamSelect').value;
    if (team && (cell.textContent.trim() === team)) {
      cell.classList.add('team-highlight');
    }
  } else {
    const existingWatermark = cell.querySelector('.option-watermark');
    if (existingWatermark) {
      existingWatermark.remove();
    }
    
    const watermark = document.createElement('div');
    watermark.className = 'option-watermark';
    watermark.textContent = option;
    cell.appendChild(watermark);
    cell.classList.add('option-selected');
  }
  
  document.getElementById('optionsList').style.display = 'none';
  saveState(); // Save state after every option change
}

function saveCustomText() {
  const input = document.getElementById('customTextInput');
  const text = input.value.trim();
  
  if (text.length < 5 || text.length > 20) {
    alert('O texto deve ter entre 5 e 20 caracteres');
    return;
  }
  
  if (window.currentCustomCell) {
    selectOption(text, window.currentCustomCell);
    closeCustomTextDialog();
  }
}

function closeCustomTextDialog() {
  document.getElementById('customTextDialog').style.display = 'none';
  window.currentCustomCell = null;
}

// Load saved state when page loads
document.addEventListener('DOMContentLoaded', () => {
  loadSavedState();
  updateSchedule();
  updateMotivationalQuote();
  setInterval(updateMotivationalQuote, 10000);

  // Close options list when clicking outside
  document.addEventListener('click', (e) => {
    const optionsList = document.getElementById('optionsList');
    if (!e.target.closest('td') && !e.target.closest('.options-list')) {
      optionsList.style.display = 'none';
    }
  });
});
</script>
</body>
</html>